<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE task PUBLIC "-//OASIS//DTD DITA Task//EN" "task.dtd">
<task id="securing_ldap_docker" xml:lang="en-us">
    <title>Securing LDAP on Docker</title>
    <shortdesc>This topic covers the steps to import your LDAP trust store and password into Docker
        as a secret, then define the secret in the Sametime configuration. </shortdesc>
    <taskbody>
        <prereq id="prereq_zm2_mb2_xtb">Before getting started, create a trust store with the LDAP
            certificate from the LDAP server. Name the file <filepath>ldaptruststore.p12 </filepath>
            and place it into the directory where the <filepath>docker-compose.yml</filepath> file
            is located.</prereq>
        <context id="context_wy2_nb2_xtb">
            <p>The steps in the following procedure must be  completed with root access or you can
                use  <cmdname>sudo</cmdname> which allows you to run commands as root.</p>
        </context>
        <steps id="steps_bnd_phj_k5b">
            <step>
                <cmd>Change directories to the root directory where Sametime installation package
                    was decompressed.</cmd>
            </step>
            <step>
                <cmd>Create a new file called <filepath>tlsldap.env</filepath>. </cmd>
                <info>
                    <codeblock id="codeblock_jxd_vhj_k5b">vi tlsldap.env</codeblock>
                </info>
            </step>
            <step>
                <cmd>Add the following lines into the <filepath>tlsldap.env</filepath> file. </cmd>
                <info>
                    <codeblock id="codeblock_kt5_xhj_k5b">
STI__Config__STLDAP_TLS_TRUST_STORE_TYPE=p12 
STI__Config__STLDAP_TLS_TRUST_STORE_FILE=/local/notesdata/ldaptruststore.p12 
STI__Config__STLDAP_TLS_TRUST_STORE_PASSWORD=ldaptruststorepass</codeblock>
                </info>
            </step>
            <step>
                <cmd>Open the <filepath>docker-compose.yaml</filepath> for editing.</cmd>
                <substeps id="substeps_dkc_33j_k5b">
                    <substep>
                        <cmd>Locate the  <parmname>env_file:</parmname> parameter and move
                                <codeph>custom.env</codeph> to a new line.</cmd>
                    </substep>
                    <substep>
                        <cmd>Add the following line below <codeph>custom.env</codeph>.</cmd>
                        <info>
                            <codeblock id="codeblock_ybs_j24_k5b"> tlsldap.env</codeblock>
                        </info>
                        <info>The results should look like the
                            following:<codeblock id="codeblock_tc5_l24_k5b">
env_file:
  - custom.env
  - tlsldap.env</codeblock></info>
                    </substep>
                </substeps>
            </step>
            <step id="docker_truststore_setpath">
                <cmd>Add a path to the LDAP trust store.</cmd>
                <choices id="choices_kjf_hf4_k5b">
                    <choice>If you do not have a volumes section in the
                            <filepath>docker-compose.yml</filepath> file, create one under the
                        networks section and add the following line to the section.</choice>
                    <choice>If you already have a volumes section, add the following line to the
                        section.</choice>
                </choices>
                <info>
                    <codeblock id="codeblock_gt3_x24_k5b">- ./ldaptruststore.p12:/local/notesdata/ldaptruststore.p12 </codeblock>
                </info>
                <info>The section should look like the following example. Ensure that the
                    indentations look like the example.<codeblock id="codeblock_zb1_bf4_k5b">
networks:
  - sametime.test
volumes:
  - ./ldaptruststore.p12:/local/notesdata/ldaptruststore.p12</codeblock></info>
            </step>
            <step>
                <cmd>Start the Sametime server to apply the changes.</cmd>
                <info>
                    <codeblock id="codeblock_btc_lj4_k5b">docker-compose up -d
</codeblock>
                </info>
            </step>
        </steps>
    </taskbody>
</task>
