<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE task PUBLIC "-//OASIS//DTD DITA Task//EN" "task.dtd">
<task id="securing_ldap_kubernetes" xml:lang="en-us">
    <title>Securing LDAP on Kubernetes</title>
    <shortdesc>This section covers the steps to import your LDAP trust store and password into
        Kubernetes as a secret, then define the secret in the Sametime configuration. </shortdesc>
    <taskbody>
        <prereq id="prereq_zm2_mb2_xtb">Create a trust store in p12 format that contains a copy of
            the LDAP serverâ€™s certificate. To perform this step you will need to know the password
            of your trust store. </prereq>
        <context id="context_wy2_nb2_xtb">The changes in this task affect the following pods:<ul
                id="ul_yqd_j1d_d5b">
                <li>community</li>
            </ul></context>
        <steps id="steps_upp_nb2_xtb">
            <step>
                <cmd>Create a secret a secret that contains your certificate.</cmd>
                <substeps id="substeps_zb1_sb2_xtb">
                    <substep>
                        <cmd> Rename your trust store file name to
                                <filepath>ldaptruststore.p12.ls</filepath>.</cmd>
                    </substep>
                    <substep>
                        <cmd> Copy the <filepath>ldaptruststore.p12</filepath> file to the machine
                            where you are running <cmdname>kubectl</cmdname>.</cmd>
                    </substep>
                    <substep>
                        <cmd>Run the following command to create the Kubernetes secret.</cmd>
                        <info><codeblock id="codeblock_e2b_5d2_xtb">kubectl create secret generic ldap-config-secret --from-literal=KeyStorePassword=<varname>password</varname> --from-file=./ldaptruststore.p12</codeblock>Substitute
                            your password for <varname>password</varname>. If you have a namespace
                            dedicated to Sametime, add the <parmname>-n</parmname> argument with
                            your namespace to ensure the secret is created in the correct
                            namespace.</info>
                    </substep>
                    <substep>
                        <cmd>Change to the <filepath>helm</filepath> directory where the Sametime
                            installation package was decompressed. Open the
                                <filepath>values.yaml</filepath> file to update the secret
                            parameter.</cmd>
                        <info>Set the value of the <codeph>ldapConfigSecret</codeph> parameter to
                                <codeph>ldap-config-secret</codeph>.
                            <codeblock id="codeblock_dly_l22_xtb">ldapConfigSecret: ldap-config-secret </codeblock>
                            If the parameter is commented out, remove the comment tag.</info>
                    </substep>
                    <substep>
                        <cmd>Save and close the file.</cmd>
                    </substep>
                    <substep>
                        <cmd>Ensure you are in the <filepath>helm</filepath> directory. To apply
                            your changes to the environment run the following command, specifying
                            the deployment name in your environment. The default for Sametime
                            version 12 is <parmname>sametime</parmname>.</cmd>
                        <info><codeblock id="codeblock_bvg_pk2_xtb">helm upgrade <varname>deployment_name</varname>.</codeblock>
                            If you are unsure of your deployment name, issue the <cmdname>helm
                                list</cmdname> command to find the name. If you upgraded from an
                            earlier Sametime release, the default name is
                                s<parmname>ametime-meetings</parmname>.<note id="note_vhk_vgf_xtb"
                                >Be sure to include the dot, it is part of the
                            command.</note></info>
                    </substep>
                    <substep>
                        <cmd>Scale the Community pods to zero and then to one.</cmd>
                        <info>Run the following command to scale the pod to zero.
                            <codeblock id="codeblock_jg4_lzy_xtb">
kubectl scale deploy community --replicas=0</codeblock></info>
                        <info>Run the following command to scale the pod to
                            one.<codeblock id="codeblock_tny_zzy_xtb">
kubectl scale deploy community --replicas=1</codeblock></info>
                    </substep>
                </substeps>
            </step>
            <step id="apply_changes_helmupgrade">
                <cmd>Apply your changes to the environment.</cmd>
                <info>Verify that you are in the <filepath>helm</filepath> directory and run the
                    following command to apply changes. Specify the Sametime deployment name for
                    your environment. The default for Sametime Premium version 12 is
                        <parmname>sametime</parmname>.<codeblock id="codeblock_iyn_51d_d5b">helm upgrade <varname>sametime_deployment_name</varname> .</codeblock><note
                        id="note_jyn_51d_d5b">Be sure to include the dot at the end. It is part of
                        the command.</note></info>
                <info>If you are unsure of your deployment name, issue the <cmdname>helm
                        list</cmdname> command to find the name. If you upgraded from an earlier
                    Sametime release, the default name is
                    <parmname>sametime-meetings</parmname>.</info>
            </step>
            <step conref="pod_apply_changes.dita#pod_apply_changes/scale_pod">
                <cmd/>
            </step>
        </steps>
    </taskbody>
</task>
