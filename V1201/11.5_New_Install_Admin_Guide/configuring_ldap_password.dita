<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE task PUBLIC "-//OASIS//DTD DITA Task//EN" "task.dtd">
<task id="configuring_ldap_password" xml:lang="en-us">
    <title>Changing the LDAP service account password in Kubernetes </title>
    <shortdesc>If you are using an authenticated bind for LDAP, with a password that expires
        periodically, you'll need to update the LDAP bind credentials for Sametime clusters in
        Kubernetes with a new password.</shortdesc>
    <taskbody>
        <context>
            <p>The LDAP bind credentials are Base64 encoded and defined in the configuration as
                secrets. When updating the password, you'll need to complete the following tasks:<ul
                    id="ul_n4b_bfl_5tb">
                    <li>Find the Base64 encoded values of your credentials.</li>
                    <li>Update the bind credentials in the Kubernetes secrets.<p>The LDAP bind
                            credentials are located in Kubernetes secrets: <ul id="ul_bxc_jfs_5tb">
                                <li><codeph>sametime-global-secrets</codeph></li>
                                <li><codeph>extra-community-config</codeph> (optional)</li>
                            </ul></p><p>There is an optional configuration to override the default
                            settings for LDAP and for business cards in a secret called
                                <parmname>extra-community-config</parmname>. If you have implemented
                            this secret, the LDAP Bind credentials must be updated in the XML
                            configuration files and the <parmname>extra-community-config</parmname>
                            secret should be deleted and recreated</p></li>
                </ul></p>
            <p>The changes in this task affect the following pods:<ul id="ul_uhp_bbd_d5b">
                    <li>Community</li>
                </ul></p>
        </context>
        <steps id="steps_qgk_lnj_5tb">
            <step>
                <cmd>Find the Base64 encoded values of your credentials.</cmd>
                <substeps id="substeps_kcd_pnj_5tb">
                    <substep>
                        <cmd>If your LDAP DN is changing, you need to Base64 encode the complete DN. </cmd>
                        <info>For example, if your LDAP DN is
                                <codeph>CN=SametimeBind,O=Example</codeph> take your DN and run the
                            below command:
                            <codeblock id="codeblock_umn_jds_5tb">echo -n “CN=SametimeBind,O=Example” | base64</codeblock>
                            For this example, the resulting value is shown below and must be
                            configured for the LdapBindEntryDn parameter in the
                                <filepath>sametime-secrets.yaml</filepath>
                            file.<codeblock id="codeblock_jbp_kds_5tb">LdapBindEntryDn: 4oCcQ049U2FtZXRpbWVCaW5kLE89RXhhbXBsZeKAnQ== </codeblock></info>
                    </substep>
                    <substep>
                        <cmd>If your LDAP bind password is changing, you need to base64 encode the
                            password.</cmd>
                        <info> For example, if your password is <userinput>thepassword</userinput>,
                            then run the below command to base64 encode it:
                            <codeblock id="codeblock_rz3_qds_5tb">echo -n “thepassword” | base64</codeblock>
                            The resulting value is used in your configuration for the
                            password.</info>
                    </substep>
                    <substep>
                        <cmd> Now find the base64 encoded value of the two settings combined,
                            separated by a colon.</cmd>
                        <info> For example if your Bind DN is <codeph id="codeblock_w35_tds_5tb"
                                >CN=SametimeBind,O=Example</codeph> and the password is
                                <userinput>thepassword</userinput> then find the base64 encoded
                            value of
                            <codeph>CN=SametimeBind,O=Example:thepassword</codeph>:<codeblock id="codeblock_djw_tnj_5tb">echo -n “CN=SametimeBind,O=Example:thepassword” | base64 </codeblock></info>
                    </substep>
                </substeps>
            </step>
            <step>
                <cmd>Update the secret for <codeph>sametime-global-secrets</codeph>.</cmd>
                <substeps id="substeps_qvk_xnj_5tb">
                    <substep>
                        <cmd>Edit the <codeph>sametime-global-secrets</codeph> file. Run the
                            following command.</cmd>
                        <info>
                            <codeblock id="codeblock_crt_rfs_5tb">kubectl edit secret sametime-global-secrets</codeblock>
                        </info>
                    </substep>
                    <substep>
                        <cmd>Locate <codeph>LdapBindEntryDn</codeph> and
                                <codeph>LdapBindEntryPassword</codeph> in the
                                <filepath>helm/templates/sametime-secrets.yaml</filepath> file. Set
                            their values to the base64 encoded value of your name and password
                            respectively. </cmd>
                        <info>
                            <codeblock>
LdapBindEntryDn: <varname>base64_encoded_DN</varname> 
LdapBindEntryPassword: <varname>base64_encoded_password</varname></codeblock>
                        </info>
                    </substep>
                    <substep>
                        <cmd>Save and close the file.</cmd>
                    </substep>
                    <substep>
                        <cmd>Press <uicontrol>Esc, w, q, !</uicontrol> on the keyboard to save your
                            changes.</cmd>
                    </substep>
                </substeps>
            </step>
            <step importance="optional">
                <cmd>Update the <codeph>extra-community-config</codeph> secret.</cmd>
                <substeps id="substeps_wk4_3dx_5tb">
                    <substep>
                        <cmd>Determine if there is already a <codeph>extra-community-config</codeph>
                            secret by issuing the following command.</cmd>
                        <info>
                            <codeblock id="codeblock_w1g_dp2_vtb">kubectl get secrets </codeblock>
                        </info>
                        <info>If you are using a namespace for Sametime, you must include the
                                <codeph>-n namespace</codeph> argument on the command to view the
                            secrets scoped to the Sametime namespace. </info>
                    </substep>
                    <substep>
                        <cmd>If there is a secret, delete it. Otherwise skip to the next step.</cmd>
                        <info>Run the following command to delete the secret.
                            <codeblock id="codeblock_gvp_pp2_vtb">kubectl delete secret extra-community-configs</codeblock></info>
                    </substep>
                </substeps>
            </step>
            <step>
                <cmd>Create a new directory named <filepath>extra-community-configs</filepath> on
                    the machine that is used to run <cmdname>kubectl</cmdname> commands. </cmd>
            </step>
            <step>
                <cmd>Change directories to the <filepath>extra-community-configs</filepath> you just
                    created.</cmd>
            </step>
            <step>
                <cmd>Locate the pod name of the Community pod to be used in the next step by running
                    following the command.</cmd>
                <info><codeblock id="codeblock_ank_lkd_xtb">kubectl get pods</codeblock>The name has
                    hashes in it, for example: <codeph>community-845d5d5755-z7zf7 </codeph>.</info>
            </step>
            <step>
                <cmd>Pull a copy of the <filepath>StCommunityConfigs.xml</filepath> from the
                    Community pod by running the below command, where <varname>podname</varname> is
                    the Community pod name found in the previous step.</cmd>
                <info>
                    <codeblock id="codeblock_v2k_wnx_wtb">kubectl exec -it <varname>podname</varname> --container community -- cat /local/notesdata/StCommunityConfig >./StCommunityConfig.xml </codeblock>
                </info>
                <stepxmp>For example, if the Community pod name is
                        <userinput>community-845d5d5755-z7zf7</userinput>, the command to run is
                    <codeblock id="codeblock_njq_ykd_xtb">kubectl exec -it community-845d5d5755-z7zf7 --container community -- cat /local/notesdata/StCommunityConfig.xml >./StCommunityConfig.xml </codeblock></stepxmp>
            </step>
            <step>
                <cmd>Pull a copy of the <filepath>UserInfoConfig.xml</filepath> file from the
                    Community pod, by running the below command. Substitute the name of your
                    Community pod for <varname>podname</varname>.</cmd>
                <info>
                    <codeblock id="codeblock_wtp_d4x_wtb"><varname>podname</varname>: kubectl exec -it &lt;podname> --container community -- cat /local/notesdata/UserInfoConfig.xml >./UserInfoConfig.xml </codeblock>
                </info>
                <stepxmp>For example, if the Community pod name is
                        <userinput>community-845d5d5755-z7zf7</userinput>, the command to run is
                    <codeblock id="codeblock_ldq_h4x_wtb">kubectl exec -it community-845d5d5755-z7zf7 --container community -- cat /local/notesdata/UserInfoConfig.xml >./UserInfoConfig.xml </codeblock></stepxmp>
            </step>
            <step>
                <cmd>After adding the two files to your machine, the new LDAP DN and password must
                    be defined. Open the local copy of the
                        <filepath>StCommunityConfig.xml</filepath> file using a file editor.</cmd>
                <info>Locate the parameters to be changed and set them to their actual unencoded
                    values. Do not specify the base64 encode values. <ul id="ul_tcm_bmd_xtb">
                        <li>Set <codeph>BindEntryDn</codeph>= to the Bind DN </li>
                        <li>Set <codeph>BindEntryPwd=</codeph> set to the new Bind password</li>
                    </ul> Save and close the file. </info>
            </step>
            <step>
                <cmd>Open the <filepath>UserInfoConfig.xml</filepath> file. Next change the
                        <codeph>UserEncodedAuth</codeph> value.</cmd>
                <substeps id="substeps_ehm_mmd_xtb">
                    <substep>
                        <cmd>Locate <codeph>UserEncodedAuth</codeph> in the file.</cmd>
                    </substep>
                    <substep>
                        <cmd>Change the current value to the base64 encoded values of the DN and
                            password.</cmd>
                        <info>Combine the two values with a colon (:) between them. For example:
                            <codeblock id="codeblock_fzv_1nd_xtb">echo -n <varname>DN</varname>:<varname>password</varname> echo -n 'DN:password' | base64</codeblock></info>
                    </substep>
                    <substep>
                        <cmd>Save and close the file.</cmd>
                    </substep>
                </substeps>
            </step>
            <step>
                <cmd>Create the <codeph>extra-community-configs</codeph> secret by issuing the
                    following command.</cmd>
                <info>
                    <codeblock id="codeblock_cn4_snd_xtb">kubectl create secret generic extra-community-config --from-file=./</codeblock>
                </info>
            </step>
            <step>
                <cmd>Update the configuration files.</cmd>
                <info>If you did not have an <codeph>extra-community-configs</codeph> secret before
                    you must update the <filepath>values.yaml</filepath> file for Sametime to use
                    the secret.</info>
                <substeps id="substeps_ix5_54x_wtb">
                    <substep>
                        <cmd>Change to the <filepath>helm</filepath> directory, where the Sametime
                            installation image was unzipped.</cmd>
                    </substep>
                    <substep>
                        <cmd>Open the <filepath>values.yaml</filepath> file with a text editor.
                        </cmd>
                    </substep>
                    <substep>
                        <cmd>Add the following parameter to the global section.</cmd>
                        <info>
                            <codeblock id="codeblock_ics_x4d_xtb">overrideCommunityConfigSecret: "extra-community-config"</codeblock>
                        </info>
                    </substep>
                    <substep>
                        <cmd>Save and close the file.</cmd>
                    </substep>
                </substeps>
            </step>
            <step conref="pod_apply_changes.dita#pod_apply_changes/scale_pod">
                <cmd/>
            </step>
        </steps>
    </taskbody>
</task>
