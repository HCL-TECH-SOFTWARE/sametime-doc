<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE task PUBLIC "-//OASIS//DTD DITA Task//EN" "task.dtd">
<task id="enabling_saml_docker" xml:lang="en-us">
    <title>Configuring SAML on Docker</title>
    <shortdesc/>
    <taskbody>
        <prereq id="prereq_zm2_mb2_xtb">Before getting started, create a trust store with the LDAP
            certificate from the LDAP server. Name the file <filepath>ldaptruststore.p12 </filepath>
            and place it into the directory where the <filepath>docker-compose.yml</filepath> file
            is located.</prereq>
        <context id="context_wy2_nb2_xtb">
            <p>The steps in the following procedure must be  completed with root access or you can
                use  <cmdname>sudo</cmdname> which allows you to run commands as root.</p>
        </context>
        <steps id="steps_yjs_qz3_5tb">
            <step>
                <cmd>Change directories to the root directory where the Sametime installation
                    package was decompressed.</cmd>
            </step>
            <step>
                <cmd>Create a file with the name <filepath>saml.env</filepath>.</cmd>
                <info>
                    <codeblock id="codeblock_n3n_tcq_k5b">vi saml.env</codeblock>
                </info>
            </step>
            <step>
                <cmd>Add the following lines to the <filepath>saml.env</filepath> file. </cmd>
                <info>
                    <codeblock id="codeblock_crt_vcq_k5b">
STI__Config__STSAML_TRUST_STORE_TYPE=p12  
STI__Config__STSAML_TRUST_STORE_FILE=/local/notesdata/samltruststore.p12 
STI__Config__STSAML_TRUST_STORE_PASSWORD=samltruststorepass </codeblock>
                </info>
            </step>
            <step>
                <cmd>Open the <filepath>docker-compose.yaml</filepath> file for editing. Locate the
                        <parmname>env_file:</parmname> parameter in the file and move
                        <parmname>custom.env</parmname> to a new line. Add
                        <parmname>saml.env</parmname> to the next line after
                        <parmname>custom.env</parmname>.</cmd>
                <info>
                    <codeblock id="codeblock_b51_h3x_k5b">
env_file: 
 - custom.env
 - saml.env
</codeblock>
                </info>
            </step>
            <step>
                <cmd>Add a path to the SAML trust store.</cmd>
                <choices id="choices_ovw_w3x_k5b">
                    <choice>If you do not have a volumes section in the
                            <filepath>docker-compose.yml</filepath> file, create one under the
                        networks section and add the following line to the section.</choice>
                    <choice>If you already have a volumes section, add the following line to the
                        section.</choice>
                </choices>
                <info>
                    <codeblock id="codeblock_pvw_w3x_k5b">- ./samltruststore.p12:/local/notesdata/samltruststore.p12 </codeblock>
                </info>
                <info>The section should look like the following example. Ensure that the
                    indentations look like the example.<codeblock id="codeblock_qvw_w3x_k5b">
networks:
  - sametime.test
volumes:
  - ./samltruststore.p12:/local/notesdata/samltruststore.p12</codeblock></info>
            </step>
            <step>
                <cmd>Start the Sametime server to apply the changes.</cmd>
                <info>
                    <codeblock id="codeblock_btc_lj4_k5b">docker-compose up -d
</codeblock>
                </info>
            </step>
        </steps>
    </taskbody>
</task>
