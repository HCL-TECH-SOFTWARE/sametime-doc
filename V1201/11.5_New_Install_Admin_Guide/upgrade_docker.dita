<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE task PUBLIC "-//OASIS//DTD DITA Task//EN" "task.dtd">
<task id="upgrade_docker">
    <title>Upgrading Sametime 11.5 and Sametime 11.6 Docker deployments</title>
    <taskbody>
        <prereq id="prereq_y1s_32g_c5b">
            <p>To upgrade from Sametime 11.5 or Sametime 11.6 to Sametime 12, the following
                conditions must be satisfied:</p>
            <p>
                <ul id="ol_cj1_2sl_c5b">
                    <li>HCL Sametime Meetings 11.5 or Sametime 11.6 must be installed and
                        configured.</li>
                    <li>Sametime has access to a MongoDB server. You can re-use your existing
                        MongoDB server.<note id="note_xq1_gsl_c5b"> There are no special
                            configuration steps required for the database. It automatically creates
                            when the Sametime server connects to MongoDB.</note></li>
                    <li>Prepare migration steps before upgrading to the latest Sametime version. The
                        upgrade gives you a new community and proxy component that replaces your
                        existing components.<ul id="ol_lby_mtl_c5b">
                            <li>Have a back-out plan. Create a backup of the following files.<ul
                                    id="ul_ncb_rtl_c5b">
                                    <li>docker-compose.yml</li>
                                    <li>custom.env</li>
                                    <li>.env</li>
                                </ul></li>
                        </ul></li>
                    <li>Docker Compose 1.29 or higher must be installed in your Sametime
                        environment.</li>
                </ul>
            </p>
        </prereq>
        <context>
            <p>Upgrading Sametime 11.5 or Sametime 11.6 Docker deployments are done in the
                custom.env file. The upgrade requires access to the MongoDB server. For this
                example, we will use the following directory structure for
                simplicity:<codeblock id="codeblock_dgx_y5l_c5b"><filepath>/opt/STMeetingServer</filepath></codeblock></p>
        </context>
        <steps>
            <step>
                <cmd>In <filepath>/opt/STMeetingserver</filepath>, stop the Sametime Meeting server
                    by executing:</cmd>
                <info>
                    <codeblock id="codeblock_djt_cvl_c5b">> docker-compose down</codeblock>
                </info>
            </step>
            <step>
                <cmd>Unzip the sametime.meeting archive to /opt/STMeetingServer - this will
                    overwrite several files in the folder.</cmd>
                <info>
                    <codeblock id="codeblock_dny_hvl_c5b">> unzip sametime-meetings.zip -d /opt/STMeetingServer</codeblock>
                </info>
            </step>
            <step>
                <cmd>Run the script below: </cmd>
                <info>
                    <codeblock id="codeblock_uwj_nvl_c5b">> ./install.sh</codeblock>
                </info>
            </step>
            <step>
                <cmd>Follow the prompts to provide the information as required. You can copy the
                    encoded secret from sametime.ini or create a new one with this update. Sametime
                    detects an upgrade or full install.</cmd>
                <info>
                    <note id="note_hgd_gxh_rvb">If the you are not prompted for Auth Token, LDAP and
                        Proxy, the <filepath>custom.env</filepath> file must be updated after the
                        upgrade. Specify the appropriate values for the Auth Token, LDAP and set the
                        Proxy to be the Sametime 12 host. Additionally, the MongoDB administrative
                        user (sametimeUser) requires that the following be
                        added:<codeblock id="codeblock_hr4_nxh_rvb">{ role:"readWrite", db:"meeting"},{role:"dbAdmin", db:"meeting"}</codeblock></note>
                </info>
            </step>
            <step>
                <cmd>Update the new <filepath>jitsi-config</filepath> folder to change TLS
                    certificates or other custom settings as needed. Be sure to follow the standard
                    procedures for that.</cmd>
            </step>
            <step>
                <cmd>After upgrade is complete, clear the browser cache to refresh the
                    authentication tokens that may be stored.</cmd>
            </step>
        </steps>
    </taskbody>
    <task id="task_sxq_dwl_c5b">
        <title>Revert to the previous version</title>
        <taskbody>
            <context>
                <p>If you encounter a problem, run the command below to roll back to the previous
                    version.<codeblock id="codeblock_vzr_fwl_c5b">in /opt/STMeetingServer issue
>docker-compose down

in /opt/STMeetingServer_bak issue
> docker-compose up -d</codeblock></p>
            </context>
        </taskbody>
    </task>
</task>
