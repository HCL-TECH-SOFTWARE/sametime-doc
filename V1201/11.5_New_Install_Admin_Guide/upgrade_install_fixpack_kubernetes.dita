<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE task PUBLIC "-//OASIS//DTD DITA Task//EN" "task.dtd">
<task id="upgrade_install_fixpack_kubernetes" xml:lang="en-us">
    <title>Installing a fix pack on Kubernetes</title>
    <shortdesc/>
    <taskbody>
        <context id="context_xlj_b5t_25b">
            <p>For Sametime upgrades, the upgrade package includes full helm charts that need to be
                implemented. You need to port your settings over from your
                    <filepath>values.yaml</filepath> into the new <filepath>values.yaml</filepath>
                file. Do not restore your <filepath>values.yaml</filepath> from a back up because
                there may be some deprecated settings.</p>
        </context>
        <steps id="steps_h34_glk_25b">
            <step>
                <cmd>Download and extract the Sametime fix pack zip files into a directory on either
                    the master Kubernetes host or on a machine which has management access to the
                    Kubernetes cluster.</cmd>
            </step>
            <step>
                <cmd>Run the following command to load the fix pack Docker image to the Docker
                    repository.</cmd>
                <info>
                    <codeblock id="codeblock_nwr_lpk_25b">./load.sh</codeblock>
                </info>
                <info>If your image repository requires a secret, then define the secret name in the
                        <filepath>values.yaml</filepath> file.</info>
                <info>If your image repository requires a secret, then define in the secret name on
                    the <parmname>hclImagePullSecret</parmname> setting in the
                        <filepath>values.yaml</filepath> file.</info>
            </step>
            <step>
                <cmd>Edit the <filepath>values.yaml</filepath> file as needed.</cmd>
            </step>
            <step>
                <cmd>Run the following script to update the current configuration to
                        <filepath>values.yaml</filepath> file as needed. You are prompted for any
                    missing information.</cmd>
                <info>
                    <codeblock id="codeblock_klx_qpk_25b">./prepareDeployment.sh</codeblock>
                </info>
            </step>
            <step>
                <cmd>When prompted to confirm the upgrade, answer <userinput>Y</userinput> to
                    proceed with the current settings. If your response is
                    <userinput>No</userinput>, you are prompted for necessary information.</cmd>
            </step>
            <step>
                <cmd>If the community LDAP settings are overridded in your deployment using an
                        <parmname>extra-community-config</parmname> secret, there are changes to
                    these files that need to be included as a part of the upgrade.</cmd>
                <substeps id="substeps_j5t_xxh_rvb">
                    <substep>
                        <cmd>Delete the secret by running the following command:</cmd>
                        <info>
                            <codeblock id="codeblock_pzp_3yh_rvb">kubectl delete secret extra-community-config</codeblock>
                        </info>
                    </substep>
                    <substep>
                        <cmd>Comment out the following line in the  <filepath>values.yaml</filepath>
                            file using the comment (#) character.</cmd>
                        <info>
                            <codeblock id="codeblock_vpm_nyh_rvb"># overrideCommunityConfigSecret: extra-community-config</codeblock>
                        </info>
                    </substep>
                </substeps>
                <info>When the upgrade is finished, pull new copies of
                        <filepath>StCommunityConfig.xml</filepath> and
                        <filepath>UserInfoConfig.xml</filepath> files. Modify the files to include
                    your custom settings. Create the <parmname>extra-community-config</parmname>
                    secret again with your changes.</info>
            </step>
            <step>
                <cmd>If you have enabled telephony, copy the secrets from your old helm charts to
                    the new ones.</cmd>
                <substeps id="substeps_o2k_pzh_rvb">
                    <substep>
                        <cmd>Copy the existing setting <codeph>application-registry.json</codeph>
                            from <filepath>/helm/templates/auth-config-secrets.yaml</filepath> into
                            your new <filepath>/helm/templates/auth-config-secrets.yaml</filepath>
                            file. </cmd>
                    </substep>
                    <substep>
                        <cmd>Copy the existing <parmname> JigasiSipUri</parmname> and
                                <parmname>JigasiSipPassword</parmname> settings from the<filepath>
                                /helm/templates/sametime-secrets.yaml</filepath> file to the new
                                <filepath>/helm/templates/sametime-secrets.yaml</filepath> file.
                        </cmd>
                    </substep>
                </substeps>
            </step>
            <step
                conref="securing_ldap_kubernetes.dita#securing_ldap_kubernetes/apply_changes_helmupgrade">
                <cmd/>
            </step>
        </steps>
    </taskbody>
</task>
