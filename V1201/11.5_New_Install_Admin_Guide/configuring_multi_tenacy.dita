<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE task PUBLIC "-//OASIS//DTD DITA Task//EN" "task.dtd">
<task id="configuring_multi_tenacy" xml:lang="en-us">
    <title>Enabling multi-tenancy </title>
    <shortdesc>Multi-tenancy allows multiple organizations to be part of the Sametime community.
        With multi-tenancy, Sametime users can chat, add users and groups to contact lists, and have
        awareness of users in their organization or in other organizations that are configured to be
        visible to them. </shortdesc>
<taskbody>
<context>
    <p>The multi-tenancy feature uses customized Java™ code to dynamically generate a filter and base distinguished names for LDAP searches on the Sametime Community Server. The <codeph>CustomizedMultitenancy.class</codeph> and <codeph>ConfigLoader.class</codeph> Java files containing the required code are automatically installed during the Sametime Community Server installation. The <codeph>CustomizedMultitenancy.ini</codeph> file is also installed and contains the configuration settings and the configuration instructions for the multi-tenancy feature. These files are located in the java directory where Domino is installed.</p>
    <p><b>For example,</b>on Windows ﻿C:\Program Files\HCL\Domino\java.</p>
    <p>The multi-tenancy feature is disabled by default.</p>
    <p><b>Prerequisite LDAP Requirements </b></p>
    <p>Users from all organizations should reside under one tree, with multiple branches. </p>
<p><b>For example:</b></p>
    <p>If the base DN is CN=ORGANIZATIONS,OU=COLLAB,DC=HCL,DC=COM </p>
    <p>An individual organization would be found at this baseDN(s): </p>
    <p>O=Organization A,CN=ORGANIZATIONS,OU=COLLAB,DC=HCL,DC=COM </p>
    <p>O=Organization B,CN=ORGANIZATIONS,OU=COLLAB,DC=HCL,DC=COM </p>
    <p>Additionally, each user’s entry in LDAP must contain an attribute that also contains the name of the organization that the user belongs to. </p>
    <p><b>For example,</b>you can create an attribute called “organizationName” and the value set to the name of the organization.</p>
    <p>organizationName=Organization A.</p>
   </context>
    <steps>
        <step>
            <cmd>Before making edits to the configuration, review your LDAP base DNs to determine which values should be used inside the <codeph>CustomizedMultitenancy.ini</codeph>. </cmd>
        </step>
        <step>
            <cmd>Complete the worksheet below to assist in completing the configuration: </cmd>
            <info><table frame="all" rowsep="1" colsep="1" id="configuration">
                <tgroup cols="4">
                    <colspec colname="c1" colnum="1" colwidth="1*"/>
                    <colspec colname="c2" colnum="2" colwidth="1*"/>
                    <colspec colname="c3" colnum="3" colwidth="1*"/>
                    <colspec colname="c4" colnum="4" colwidth="1*"/>
                    <thead>
                        <row>
                            <entry>Setting Name</entry>
                            <entry>Description</entry>
                            <entry>Example</entry>
                            <entry>Your Value</entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>Base DN </entry>
                            <entry>This is the top of your LDAP tree, where to start searching the directory </entry>
                            <entry>CN=ORGANIZATIONS,OU=COLLAB, DC=HCL,DC=COM</entry>
                            <entry></entry>
                        </row>
                        <row>
                            <entry>Organization BaseDN </entry>
                            <entry>This is the location of the individual organizations. </entry>
                            <entry>O=Organization A,CN=ORGANIZATIONS, OU=COLLAB,DC=HCL,DC=COM </entry>
                            <entry></entry>
                        </row>
                        <row>
                            <entry>﻿ORG_PART_OF_DN </entry>
                            <entry>The attribute in the LDAP DN that contains the organization name.  </entry>
                            <entry>O</entry>
                            <entry></entry>
                        </row>
                        <row>
                            <entry>﻿PEOPLE_ROOT_BASE_DN </entry>
                            <entry>This is the DN of the entry where to start searching for people. It should contain the lowest LDAP entry under which the entries of all the people in the organization are available. </entry>
                            <entry>O=%S,CN=ORGANIZATIONS, OU=COLLAB,DC=HCL,DC=COM </entry>
                            <entry></entry>
                        </row>
                        <row>
                            <entry>﻿GROUPS_ROOT_BASE_DN </entry>
                            <entry>This is the DN of the entry where to start searching for groups. It should contain the lowest LDAP entry under which the entries of all the people in the organization are available. </entry>
                            <entry>O=%S,CN=ORGANIZATIONS, OU=COLLAB,DC=HCL,DC=COM </entry>
                            <entry></entry>
                        </row>
                        <row>
                            <entry>﻿PEOPLE_BASE_DN_TEMPLATE </entry>
                            <entry>﻿The DN of the entry at which to start the people or the groups LDAP search when the search is done in a sub tree of a particular organization. 
                                
                                %S should always be present in the value. It will be dynamically replaced by the organization name during the resolve operation. </entry>
                            <entry>O=%S </entry>
                            <entry></entry>
                        </row>
                        <row>
                            <entry>﻿GROUPS_BASE_DN_TEMPLATE </entry>
                            <entry>The DN of the entry at which to start the people or the groups LDAP search when the search is done in a sub tree of a particular organization. 
                                
                                %S should always be present in the value. It will be dynamically replaced by the organization name during the resolve operation. </entry>
                            <entry>O=%S </entry>
                            <entry></entry>
                        </row>
                        <row>
                            <entry>﻿LDAP_ORG_ATTR </entry>
                            <entry>﻿The attribute in the LDAP directory that is present in every person and group entry and contains the organization name that this person or group belongs to. </entry>
                            <entry>ORGANIZATIONNAME</entry>
                            <entry></entry>
                        </row>  
                    </tbody>
                </tgroup>
            </table>
                <p><note><b>Every value in the <codeph>customizedMultitenancy.ini</codeph> must be in upper case. </b></note></p></info>
        </step>
        <step>
            <cmd>Using the values that have been identified, populate the settings in the <codeph>customizedMultitenancy.ini</codeph> file, following the examples inside the file. The <codeph>customizedMultitenancy.ini</codeph> is in the java folder inside the Domino program directory.
            </cmd>
        </step>
        <step>
            <cmd>Save and close the customizedMultitenancy.ini file when complete. </cmd>
        </step>
        <step>
            <cmd>Open the <codeph>sametime.ini</codeph> file using a text editor. </cmd>
        </step>
        <step>
            <cmd>Locate the existing [Config] section of the file. </cmd>
            <info><ul>
                <li>For Windows installs, add the following line, ensuring the correct path to the java directory:  
                    <p><codeph> ST_JAVA_CUSTOM_PATH=C:\Program Files\HCL\Domino\java </codeph></p></li>
                <li>For Linux installs, add the following line, ensuring the correct path to the java directory: 
                    <p><codeph>ST_JAVA_CUSTOM_PATH=/local/notesdata/java</codeph></p></li>
            </ul>
               </info>
        </step>
        <step>
            <cmd>Review the <codeph>ST_JAVA_CLASS_PATH</codeph> line and confirm that the path you entered in the above step is listed first on this line.</cmd>
        </step>
        <step>
            <cmd><uicontrol>Save</uicontrol> and <uicontrol>Close</uicontrol> the <codeph>sametime.ini</codeph> file.</cmd>
        </step>
        <step>
            <cmd>Launch the HCL Notes or Administrator client. </cmd>
        </step>
        <step>
            <cmd>Click <uicontrol>Open</uicontrol> > <uicontrol>Applications</uicontrol> > <uicontrol>Open an Application</uicontrol> </cmd>
        </step>
     
        <step>
            <cmd>In the server name field, enter the Sametime Community server name. In the filename field enter <codeph>“stconfig.nsf”</codeph>.</cmd>
        </step>
        <step>
            <cmd>Double-click the LDAPServer document. </cmd>
        </step>
        <step>
            <cmd>Inside the LDAPServer document, double-click to place in edit mode. </cmd>
        </step>
        <step>
            <cmd>Change the following fields to the values shown below: </cmd>
            <info><p>Search filter for resolving person names:CustomizedMultitenancy.peopleResolveFilter() </p>
                <p>Search filter for resolving group names: CustomizedMultitenancy.groupsResolveFilter() </p>
                <p>Base object when searching for person entries: CustomizedMultitenancy.peopleBaseDn() </p>
                <p>Base object when searching for group entries: CustomizedMultitenancy.groupsBaseDn() </p></info>
        </step>
        <step>
            <cmd>Click <uicontrol>File</uicontrol> > <uicontrol>Save</uicontrol> to save the document.</cmd>
        </step>
        <step>
            <cmd>Restart the Community Server for these settings to take effect.</cmd>
        </step>
            <step>
                <cmd>On the Sametime Proxy server, add the following section to the
                    stproxyconfig.xml file with the appropriate values for your configuration.</cmd>
                <info>
                    <codeblock>&lt;multiTenancy>
&lt;key>O&lt;/key>
&lt;attr>ORGANIZATIONNAME&lt;/attr>
&lt;/multiTenancy>
&lt;/configuration></codeblock>
                </info>
            </step>
            <step>
<cmd>On the<b> Sametime Meeting server</b>, add the JWT_ORGID_KEY attribute to the
<filepath>custom.env</filepath> file with the appropriate values for your configuration. The value
for  JWT_ORGID_KEY must be the same key value used in the proxy configuration for the
multiTency.</cmd>
<info>
<codeblock id="codeblock_jpv_mwq_spb">&lt;multiTenancy>
&lt;key>O&lt;/key>
&lt;attr>JWT_ORGID_KEY=O&lt;/attr>
&lt;/multiTenancy>
&lt;/configuration></codeblock>
</info>
</step>
       <step>
           <cmd>Restart the Sametime Proxy server for the settings to take affect.</cmd>
       </step>
    </steps>
</taskbody>
</task>
