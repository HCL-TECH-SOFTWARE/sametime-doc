<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE task PUBLIC "-//OASIS//DTD DITA Task//EN" "task.dtd">
<task id="admin_policy_enable_custom" xml:lang="en-us">
	<title>Allowing or restricting custom policies for Sametime clients</title>
<shortdesc>Optionally allow or restrict features for clients by creating exception rules for the
policy service in the <filepath>policyExceptions.xml</filepath> file.</shortdesc>
<taskbody>
<context> <p>Sometimes you need to disable features for a specific
client version or for particular client IDs; for example because of
a known problem or a limitation. You can either allow or restrict
custom policies for specific client versions and IDs.</p> <p>The policy service on the Sametime server manages a list of exception rules for specific client
				versions and client types (IDs). The exceptions are assigned a "weight" and are then
				compared with the user's policy assignment weight, which was calculated by the
				policy service. If the exception is weighted higher, the user will be assigned the
				exceptions defined in the <filepath>policyExceptions.xml</filepath> file. </p> <p>The
code that handles exception rules is invoked after a user policy is
 calculated. The STPolicy application (on the Community Server) looks
for exception rules defined for a client ID and for the client version.
If more than one exception rule is found, the rule with the higher
weight is selected. The selected exception rule is applied to the
user only if its weight is higher than a weight of the policy that
was already assigned to that user by his or her direct/group assignment). </p> <p>The STPolicy application reads the exception rules when the server is started, and again every
				time the regular policy rules are loaded from the Sametime System Console (once
				every 60 minutes).</p> </context>
<steps>
<stepsection>Build the <filepath>policyExceptions.xml</filepath> file and deploy it on the Sametime
				server by completing the following steps.</stepsection>
<step><cmd>Create an XML file using standard XML syntax rules with
a text or XML/HTML editor. </cmd><info> <p>Use the following opening
and closing tags: </p> <codeblock>&lt;PolicyExceptionsRules>
   ...
&lt;/PolicyExceptionsRules></codeblock> </info></step>
<step><cmd>Determine values for the <codeph>client_ids</codeph> and <codeph>client_versions</codeph> settings.</cmd>
<info> <p>The exceptions can apply to either client versions, client
IDs, or a combination of both. </p> <ul>
<li>The client version is a base version of the client that includes all fix levels (for example
							8.5.2.0). You can specify multiple client versions.<p>The
									<codeph>client_versions</codeph> setting uses a 4 digit number
								that includes the base Sametime version. The policy exception rules
								apply to any running client that matches one of the specified
									<codeph>client_versions</codeph> values. Table 1 lists examples
								of clients and their corresponding version values.</p><table
								frame="all" id="table_1_client_versions">
								<title>Examples of client versions</title>
								<desc>The value for a client version specifies the base version,
									plus release and milestone versions, as a 4-digit number.</desc>
								<tgroup cols="2">
									<colspec colname="c1" colnum="1" colwidth="1*"/>
									<colspec colname="c2" colnum="2" colwidth="1*"/>
									<thead>
										<row>
											<entry>Client</entry>
											<entry><codeph>client_versions</codeph> value</entry>
										</row>
									</thead>
									<tbody>
										<row>
											<entry><tm tmtype="reg" trademark="Sametime"
												>Sametime</tm> 8.5.2</entry>
											<entry>8520</entry>
										</row>
										<row>
											<entry><tm tmtype="reg" trademark="Sametime"
												>Sametime</tm> 8.5.2 IFR1</entry>
											<entry>8521</entry>
										</row>
										<row>
											<entry><tm tmtype="reg" trademark="Sametime"
												>Sametime</tm> 9</entry>
											<entry>9000</entry>
										</row>
									</tbody>
								</tgroup>
							</table></li>
<li>The client ID is a specific build of a particular client (such as <tm tmtype="reg"
								trademark="Notes">Notes</tm> 8.5.2 with <tm tmtype="reg"
								trademark="Sametime">Sametime</tm> embedded 8.5.2). You can specify
							multiple client IDs.<p>The <codeph>client_ids</codeph> setting must be
								formatted in decimal format. Use the <tm tmtype="reg"
									trademark="HCL">HCL</tm> knowledge article <xref
									href="https://support.hcltechsw.com/csm?id=kb_article&amp;sysparm_article=KB0024444"
									format="html" scope="external">Table of Client types that are
									connecting to a Sametime server</xref> to identify the client
								IDs and their corresponding decimal values. Table 2 lists examples
								of clients and their corresponding hexadecimal IDs and decimal
								values, which are listed in the technote.</p><table frame="all"
								id="table_2_hex_dec_equiv">
								<title>Examples of client IDs</title>
								<desc>The value for a client ID must be specified as the decimal
									equivalent of the client's hexadecimal ID.</desc>
								<tgroup cols="3">
									<colspec colname="c1" colnum="1" colwidth="1*"/>
									<colspec colname="c2" colnum="2" colwidth="1*"/>
									<colspec colname="c3" colnum="3" colwidth="1*"/>
									<thead>
										<row>
											<entry>Client</entry>
											<entry>Hexadecimal ID</entry>
											<entry>Decimal equivalent</entry>
										</row>
									</thead>
									<tbody>
										<row>
											<entry><tm tmtype="reg" trademark="Sametime"
												>Sametime</tm> Connect client 8.5.2</entry>
											<entry>0x130D</entry>
											<entry>4877</entry>
										</row>
										<row>
											<entry><tm tmtype="reg" trademark="Notes">Notes</tm>
												8.5.2 using the Embedded <tm tmtype="reg"
												trademark="Sametime">Sametime</tm> 8.5.2
												client</entry>
											<entry>0x1240</entry>
											<entry>4672</entry>
										</row>
										<row>
											<entry><tm tmtype="reg" trademark="Notes">Notes</tm>
												9.0.1 using the Embedded <tm tmtype="reg"
												trademark="Sametime">Sametime</tm> 8.5.2
												client</entry>
											<entry>0x1298</entry>
											<entry>4760</entry>
										</row>
									</tbody>
								</tgroup>
							</table></li>
</ul> </info></step>
<step><cmd>Create the rules in the XML file by inserting a <codeph>&lt;Rule
/></codeph> section (one for each rule) between the opening and closing
tags that you created in step 1.</cmd>
<substeps>
<substep><cmd>The rule is represented as a section in the file, so
format the opening and closing tags as follows:</cmd><info> <codeblock>&lt;PolicyExceptionsRules>  
    &lt;Rule id="<varname>id</varname>" weight="<varname>weight</varname>" product="<varname>product</varname>" client_versions="<varname>client_versions</varname>" client_ids="<varname>client_ids</varname>">
         ...
    &lt;/Rule>
&lt;/PolicyExceptionsRules></codeblock> </info></substep>
<substep><cmd>Assign values to the variables in the <codeph>&lt;Rule
/></codeph> tag.</cmd><info> <p>Table 3 explains the settings used
in the <codeph>&lt;Rule /></codeph> tag.</p> <table frame="all" id="table_3_rule_settings">
<title>Settings used in the <codeph>&lt;Rule /></codeph> tag</title>
<desc>This table describes the settings used in the <codeph>&lt;Rule /></codeph> tag and provides an
example of each setting.</desc>
<tgroup cols="3">
<colspec colname="c1" colnum="1" colwidth="1*"/>
<colspec colname="c2" colnum="2" colwidth="1*"/>
<colspec colname="c3" colnum="3" colwidth="1*"/>
<thead>
<row>
<entry>Setting</entry>
<entry>Description</entry>
<entry>Example</entry>
</row>
</thead>
<tbody>
<row>
<entry><codeph>id</codeph></entry>
<entry>Required. A number that identifies the rule. The ID must be unique within the file.</entry>
<entry><codeph>id="1"</codeph></entry>
</row>
<row>
<entry><codeph>weight</codeph></entry>
<entry>Required. A number that defines the priority of the exception rule to determine whether it
should override the direct user/group policy assignment. The weight must be unique within the file
and cannot match the regular policy weights.</entry>
<entry><codeph>weight="10"</codeph></entry>
</row>
<row>
<entry><codeph>product</codeph></entry>
<entry>Required. A two-letter prefix that indicates which product feature policy is affected by the
rule: <ul>
<li><codeph>av</codeph>: audio and video (media services)</li>
<li><codeph>im</codeph>: instant messaging</li>
<li><codeph>ms</codeph>: meetings</li>
</ul></entry>
<entry><codeph>product="im"</codeph></entry>
</row>
<row>
<entry><codeph>client_versions</codeph></entry>
	<entry>Optional. This is the 4-digit number representing a specific version of the <tm
		tmtype="reg" trademark="Sametime">Sametime</tm> client. You must include either the
<codeph>client_versions</codeph> setting, the <codeph>client_ids</codeph> setting, or both settings.
If you omit the <codeph>client_versions</codeph>setting, the rule is applied only to the specified
client IDs. </entry>
<entry><codeph>client_versions="8500,8520"</codeph></entry>
</row>
<row>
<entry><codeph>client_ids</codeph></entry>
	<entry>Optional. This is the decimal value representing the ID of a particular type of <tm
		tmtype="reg" trademark="Sametime">Sametime</tm> client. You must include either the
<codeph>client_versions</codeph> setting, the <codeph>client_ids</codeph> setting, or both settings.
If you omit the <codeph>client_ids</codeph> setting, the rule is applied only to the specified
client versions.</entry>
<entry><codeph>client_ids="4870,4874"</codeph></entry>
</row>
</tbody>
</tgroup>
</table> <p>The following example shows a rule statement:</p> <codeblock>&lt;PolicyExceptionsRules>
	&lt;Rule id="1" weight="10" product="im" client_versions="8500,8520" client_ids="4870,4874">
	<varname>	(..... the policy settings are specified here ....)</varname>
	&lt;/Rule>
&lt;/PolicyExceptionsRules></codeblock> </info></substep>
</substeps>
</step>
<step><cmd>For each policy setting that is affected by the rule, create
a <codeph>&lt;Policy /></codeph> statement that specifies the policy
ID and setting for each policy exception.</cmd>
<substeps>
<substep><cmd>Begin each statement with the <codeph>&lt;Policy /></codeph> tag,
formatted as shown in the following example.</cmd><info> <codeblock>&lt;PolicyExceptionsRules>
	&lt;Rule id="1" weight="10" product="im" client_versions="8500,8520" client_ids="4870,4874">
		&lt;Policy id="<varname>id</varname>" value="<varname>value</varname>" />
	&lt;/Rule>
&lt;/PolicyExceptionsRules></codeblock> </info></substep>
<substep><cmd>Assign values to the variables in the <codeph>&lt;Policy
/></codeph> statement.</cmd><info><p>Table 4 explains the settings
used in the <codeph>&lt;Policy /></codeph> tag.</p><table frame="all" id="table_4_policy_settings">
<title>Settings used in the <codeph>&lt;Policy /></codeph> tag</title>
<desc>This table describes the settings used in the <codeph>&lt;Policy /></codeph> tag and provides
an example of each setting.</desc>
<tgroup cols="3">
<colspec colname="c1" colnum="1" colwidth="1*"/>
<colspec colname="c2" colnum="2" colwidth="1*"/>
<colspec colname="c3" colnum="3" colwidth="1*"/>
<thead>
<row>
<entry>Setting</entry>
<entry>Description</entry>
<entry>Example</entry>
</row>
</thead>
<tbody>
<row>
<entry><codeph>id</codeph></entry>
<entry>Required. Policies are predefined and are specified using their IDs. The list of policy IDs
for each product feature is available in the following topics:<ul>
<li><xref href="admin_policy_im_ids.dita#admin_policy_im_ids">Instant messaging policy
IDs</xref></li>
<?Pub Caret 1?>
												<!--<li><xref href="admin_policy_ms_ids.dita#admin_policy_ms_ids">Meetings policy IDs</xref></li>-->
												<!--<li><xref href="admin_policy_av_ids.dita#admin_policy_av_ids">Media services (audio/video) policy IDs</xref></li>-->
</ul></entry>
<entry><codeph>id="2006"</codeph></entry>
</row>
<row>
<entry><codeph>value</codeph></entry>
<entry>Required. Specify the value to use when the policy is implemented. Some values require a URL
or a numeric setting to use as a maximum or minimum amount; others might require 0 to disable or 1
to enable the policy.</entry>
<entry><codeph>value="0"</codeph></entry>
</row>
</tbody>
</tgroup>
</table><p>Important rules about creating the policy exceptions: </p><ul>
<li> List only the exceptions to a policy. The user still retrieves
their regular policy assignment and then the exceptions are applied
to that. </li>
<li>Specify only one exception rule per product for a specific client
ID or version. If more than one exception rule exists for a particular
client ID or version, the highest-weight rule will be applied and
the others will be ignored. </li>
<li>Place each setting under the appropriate product prefix (instant
messaging, meetings, or media services, described in Table 3).</li>
<li>For certain attributes, you must omit the product prefix to ensure
compatibility with older clients. <p>For historical reasons the Connect
client and the <tm tmtype="reg" trademark="Notes">Notes</tm> embedded
client support some policy attributes without a product prefix; however
the web and mobile clients support only prefixed IDs. Omit the product
prefix from the <filepath>policyExceptions.xml</filepath> file for
the following policy attributes:</p><ul>
<li>All numeric attributes for the <codeph>im</codeph> product.</li>
<li>The 2024 and 2025 attributes that include the "sut" prefix in
the <filepath>policies.user.xml</filepath> file.</li>
<li>The attribute1001 - attribute1005 attributes for the <codeph>ms</codeph> product
(they appear in the <filepath>policies.user.xml</filepath> file without
the product prefix as well). </li>
</ul></li>
<li>It is not necessary to include the "label" setting with the policy <codeph>id</codeph> in
your file. <p>Examples in the product documentation sometimes include
the label; but you can omit it. For example, if you want the policy
ID 2006 (maximum number of days to save a chat transcript) set to
0 days, the label looks like the following statement:</p><codeblock>im.2006.label = Maximum days to save automatically saved chat transcripts (IC)</codeblock><p>You
can omit that label and just use the corresponding setting tag to
set the value, as in the following statement: </p><codeblock>&lt;Policy id="2006" value="0"/></codeblock></li>
<li>Exception rules apply only to authenticated community users, each
of whom has a record in the organization's directory and is authenticated
when connecting to the community. Anonymous users will always be assigned
to the strict lowest-weight policy, regardless of the client version
or ID.</li>
</ul><p>The following code example shows an example policy statement:</p><codeblock>&lt;PolicyExceptionsRules>
	&lt;Rule id="1" weight="10" product="im" client_versions="8500,8520" client_ids="4870,4874">
		&lt;Policy id="2006" value="0" />
	&lt;/Rule>
&lt;/PolicyExceptionsRules></codeblock> </info></substep>
</substeps>
<info> <p>The following example shows two rule sections with policy
statements:</p><codeblock>&lt;PolicyExceptionsRules>
	&lt;Rule id="1" weight="10" product="im" client_versions="8500,8520" client_ids="4870,4874">
	   &lt;Policy id="2006" value="0" />
	   &lt;Policy id="2012" value="http://sametime.server.com/updates" />
	   &lt;Policy id="2014" value="800" />
	&lt;/Rule>
	&lt;Rule id="2" weight="20" product="av" client_versions="" client_ids="4868,4878">
	   &lt;Policy id="av.avCapAvailableThroughSMS" value="0" />
	   &lt;Policy id="av.allowChangesToPrefNumbers" value="0" />
	   &lt;Policy id="2024" value="0" />
	&lt;/Rule>
&lt;/PolicyExceptionsRules></codeblock><ul>
<li><codeph>Rule id="1"</codeph> uses a weight of "<codeph>10"</codeph> and
is enabled for instant messaging. It applies to client IDs <codeph>4870</codeph> and <codeph>4874</codeph>,
but only for client versions <codeph>8.5</codeph> and <codeph>8.5.2</codeph> (other
versions of those client IDs will not be affected). This rule specifies
three policies that will be applied to the specified clients when
used with instant messaging:<ul>
<li><codeph>2006</codeph> (Maximum days to save automatically saved
chat transcripts) is set to 0 days, so transcripts will not be saved.</li>
<li><codeph>2012</codeph> (<tm tmtype="reg" trademark="Sametime">Sametime</tm> update
site URL) specifies the URL where users can access client updates.</li>
<li><codeph>2014</codeph> (Limit contact list size) is set to 800
contacts per user.</li>
</ul></li>
<li><codeph>Rule id="2"</codeph> uses a weight of <codeph>"20"</codeph> and
is enabled for media services (audio and video). It applies to client
IDs <codeph>4868</codeph> and <codeph>4878</codeph>, for all versions
of those clients. This rule specifies three policies that will be
applied to the specified clients when used with media services:<ul>
<li><codeph>av.avCapAvailableThroughSMS</codeph> (Voice and video
capabilities available through the <tm tmtype="reg" trademark="Sametime">Sametime</tm> Media
Server) is set to 0, so audio/video will not be available through
the Media Manager server for the specified clients.</li>
<li><codeph>av.allowChangesToPrefNumbers</codeph> (Allow changes to
preferred numbers) is set to 0, so users cannot change preferred phone
numbers.</li>
<li><codeph>2024</codeph> (Allow changes to the permanent call routing
rule ) is set to 0, so users cannot change call routing rules.</li>
</ul></li>
</ul> </info></step>
<step><cmd>Deploy and test the <filepath>policyExceptions.xml</filepath> file.</cmd>
<substeps>
<substep><cmd>Save and close the <filepath>policyExceptions.xml</filepath> file.</cmd>
</substep>
<substep><cmd>Open the file in a browser and confirm there are no
syntax errors displayed (correct any errors before proceeding).</cmd>
</substep>
<substep><cmd>Copy the<filepath> policyExceptions.xml</filepath> file
to the <tm tmtype="reg" trademark="Domino">Domino</tm> program directory
	on every <tm
		tmtype="reg" trademark="Sametime">Sametime</tm> Community
Server in the deployment.</cmd></substep>
	<substep>
						<cmd>Restart the Sametime server (or wait for the configuration refresh
							interval, which is approximately every 60 minutes).</cmd>
					</substep>
	<substep>
						<cmd>Restart your Sametime client, log in, and confirm that the correct
							policy exceptions are displayed.</cmd>
					</substep>
</substeps>
</step>
</steps>
</taskbody>

</task>

